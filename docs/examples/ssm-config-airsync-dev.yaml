# SSM Parameter: /lights-out/dev/airsync
# AirSync Development Environment Scheduling Configuration
# Rule: Resources are shut down daily from 20:00 to 08:00 to save costs

version: "1.0"
environment: dev
project: airsync

# Resource Discovery Strategy
discovery:
  strategy: tag-based
  # Only manage resources with the following tags
  tags:
    lights-out:managed: "true"
    lights-out:env: dev
    lights-out:project: airsync
  # AWS resource types to scan
  resource_types:
    - ecs:service
    - rds:db
    - rds:cluster

# Schedule Rules
schedule:
  timezone: Asia/Taipei
  # Work hours (when resources need to be running)
  work_hours:
    start: "08:00"  # Start at 8 AM
    end: "20:00"    # Stop at 8 PM
  # Do not start resources on holidays (further cost savings)
  holidays:
    - "2025-01-01"  # New Year's Day
    - "2025-02-28"  # Peace Memorial Day
    # Add more as needed...

# Handler Behavior Configuration
handlers:
  ecs-service:
    # Set desired count to 0 when stopping
    stop_desired_count: 0
    # Restore to this count when starting (can be overridden by resource tags)
    default_desired_count: 1
  rds-db:
    # RDS auto-restarts after 7 days, needs periodic re-stopping
    auto_restart_handling: true
  rds-cluster:
    # Aurora cluster stop logic
    stop_instances_first: true

# Notification Configuration (Optional)
notifications:
  sns_topic_arn: arn:aws:sns:ap-northeast-1:123456789012:lights-out-alerts
  events:
    - resource_stopped
    - resource_started
    - error_occurred
