version: '1.0'
environment: sss-lab
regions:
  - ap-southeast-1
  - ap-northeast-1
notifications:
  teams:
    enabled: true
    webhook_url: >-
      https://defaultf7a082108cd2459f9459ddb19785f3.76.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/11f75ec7467946f7bcfb9026ab827105/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Yw8kWNrx1C6uJ2ItXBPTUrqPX_-1ZneuQX79NAaA9nk
    description: Power Automate Workflow for Notifications to Lights-Out Testing
discovery:
  method: tags
  tags:
    lights-out:managed: 'true'
    lights-out:group: lights-out-testing
  resource_types:
    - ecs:service
    - rds:db
    - rds:cluster
resource_defaults:
  ecs-service:
    waitForStable: true
    stableTimeoutSeconds: 300
    start:
      desiredCount: 1
    stop:
      desiredCount: 0
  rds-db:
    # Fire-and-forget mode: RDS start/stop takes 5-10 minutes,
    # so we don't wait for completion to avoid Lambda timeout.
    waitAfterCommand: 60 # Wait 60s after command to confirm state transition started
    skipSnapshot: true # Don't create snapshot on stop (dev environment)
  rds-cluster:
    # Aurora Cluster: same fire-and-forget mode as rds-db.
    # Note: Aurora Cluster does NOT support skipSnapshot on stop.
    # Stopping a cluster automatically stops all member instances.
    waitAfterCommand: 60
schedules:
  default:
    timezone: Asia/Taipei
    startTime: '09:00'
    stopTime: '19:00'
    activeDays:
      - MON
      - TUE
      - WED
      - THU
      - FRI
    holidays: []
    enabled: false
schedules_cron:
  start:
    expression: 0 1 ? * MON-FRI *
    description: Start resources at 09:00 Asia/Taipei (01:00 UTC)
    enabled: false
  stop:
    expression: 0 11 ? * MON-FRI *
    description: Stop resources at 19:00 Asia/Taipei (11:00 UTC)
    enabled: false
